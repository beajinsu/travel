<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <script> L_NO_TOUCH=false; L_DISABLE_3D=false; </script>
    <style>html,body{width:100%;height:100%;margin:0;padding:0;} #map{position:absolute;top:0;bottom:0;right:0;left:0;}</style>

    <!-- Leaflet -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.css"/>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.js"></script>
    <!-- Heat plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.heat/0.2.0/leaflet-heat.js"></script>
</head>
<body><div id="map"></div></body>

<script>
// Initialize map
var map = L.map('map', { center:[20,0], zoom:2 });
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution:'Data by © <a href="http://openstreetmap.org">OpenStreetMap</a>, under ODbL'
}).addTo(map);

// Load heatData (array of [lat, lng])
</script>
<script src="scripts/heat_data.js"></script>
<script>
// Create single heat layer
var heat = L.heatLayer(heatData, {
    radius:50,
    blur:50,
    maxZoom: 6,
    gradient:{0.2:'blue',0.4:'lime',0.6:'orange',0.8:'red'},
    minOpacity:0.2
}).addTo(map);

// Adjust radius/blur as zoom changes for smooth transition
function updateHeat() {
    var z = map.getZoom();
    
    // 줌 레벨별 설정 배열 [zoom_level, radius, blur, opacity]
    // 기존 로직: radius = (z < 4) ? 10 : (40 - z * 3), blur = radius / 2
    var zoomSettings = [
        [0,  10, 5,  0.3],  // z < 4이므로 radius = 10
        [1,  10, 5,  0.3],  // z < 4이므로 radius = 10
        [2,  10, 5,  0.3],  // z < 4이므로 radius = 10
        [3,  10, 5,  0.3],  // z < 4이므로 radius = 10
        [4,  28, 14, 0.4],  // z >= 4이므로 radius = 40-4*3 = 28
        [5,  25, 12, 0.5],  // z >= 4이므로 radius = 40-5*3 = 25
        [6,  22, 11, 0.6],  // z >= 4이므로 radius = 40-6*3 = 22
        [7,  19, 9,  0.7],  // z >= 4이므로 radius = 40-7*3 = 19
        [8,  16, 8,  0.8],  // z >= 4이므로 radius = 40-8*3 = 16
        [9,  13, 6,  0.9],  // z >= 4이므로 radius = 40-9*3 = 13
        [10, 10, 5,  0.9],  // z >= 4이므로 radius = 40-10*3 = 10
        [11, 7,  3,  0.9],  // z >= 4이므로 radius = 40-11*3 = 7
        [12, 4,  2,  0.9],  // z >= 4이므로 radius = 40-12*3 = 4
        [20, 4,  2,  0.9]   // 최소값 유지
    ];
    
    // 현재 줌 레벨에 맞는 설정 찾기
    var radius = 10, blur = 5, opacity = 0.3;
    for (var i = 0; i < zoomSettings.length; i++) {
        if (z <= zoomSettings[i][0]) {
            radius = zoomSettings[i][1];
            blur = zoomSettings[i][2];
            opacity = zoomSettings[i][3];
            break;
        }
    }
    
    heat.setOptions({ radius: radius, blur: blur, minOpacity: opacity });
}
map.on('zoomend', updateHeat);
updateHeat();
</script>

<!-- Load markers -->
<script src="scripts/markers.js"></script>
<script>
markers.forEach(function(m) {
    var mk = L.marker([m.lat, m.lng]).addTo(map);
    var html = m.link
        ? '<a href="'+m.link+'" target="_blank">'+m.popup+'</a>'
        : m.popup;
    mk.bindPopup(html, { maxWidth: 250 });
    mk.bindTooltip(m.tooltip||m.popup, { sticky: true });
});
</script>
</html>