<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <script>
        L_NO_TOUCH = false;
        L_DISABLE_3D = false;
    </script>
    <style>html, body {width: 100%; height: 100%; margin: 0; padding: 0;}</style>

    <!-- Leaflet core -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.css"/>
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.js"></script>

    <!-- Heat plugin -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.heat/0.2.0/leaflet-heat.js"></script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <style>
        #map_a3ca2e160c12b67f1dbe56ca7095b2fb { position: relative; width: 100%; height: 100%; }
    </style>
</head>
<body>
    <div id="map_a3ca2e160c12b67f1dbe56ca7095b2fb"></div>
</body>

<script>
    // 1) 지도 초기화
    var map = L.map("map_a3ca2e160c12b67f1dbe56ca7095b2fb", {
        center: [20, 0],      // 전세계 중심
        zoom: 2,
        zoomControl: true
    });
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: 'Data by © <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://www.openstreetmap.org/copyright">ODbL</a>'
    }).addTo(map);
</script>

<!-- HeatMap 데이터 로드 -->
<script src="scripts/heat_data.js"></script>
<script>
    // 2) HeatMap 레이어 생성 (heatData 필수)
    var heat = L.heatLayer(heatData, {
        radius: 25,
        blur: 20,
        minOpacity: 0.3,
        // 색상 그라디언트 설정 (밀도별)
        gradient: {
            0.2: 'blue',
            0.4: 'lime',
            0.6: 'orange',
            0.8: 'red'
        }
    }).addTo(map);

    // 3) 줌 레벨에 따른 반경/블러 동적 조정
    // blur는 얼마나 퍼지는지를 의미하며 radius의 값이 클수록 완만한 그라데이션 작을 수록 포인트 위주로 샤프하게
    function updateHeatLayer() {
        var z = map.getZoom();
    // 줌별 radius/blur 설정: [0, 1, 2, 3,   4,   5,   6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18]
        var radiusSettings = [7, 7, 7, 9.0, 9.0, 9.0, 11, 19, 16, 13, 10, 7, 4, 1, 0, 0, 0, 0, 0];
        var blurSettings   = [4, 4, 4, 4.2, 4.2, 4.2, 5.5,  9,  8,  6,  5, 3, 2, 1, 0, 0, 0, 0, 0]; 
        var radius = radiusSettings[z] || 0;
        var blur   = blurSettings[z]   || 0;
        heat.setOptions({ radius: radius, blur: blur });
    }
    map.on('zoomend', updateHeatLayer);
    updateHeatLayer();
</script>

<!-- Marker 데이터 로드 -->
<script src="scripts/markers.js"></script>
<script>
    // 4) Marker 레이어 그룹 생성 (초기에는 추가하지 않음)
    var markerLayer = L.layerGroup();
    markers.forEach(function(m) {
        var mk = L.marker([m.lat, m.lng]);
        var content = m.link
            ? '<a href="' + m.link + '" target="_blank">' + m.popup + '</a>'
            : m.popup;
        mk.bindPopup(content, { maxWidth: 250 });
        mk.bindTooltip(m.tooltip || m.popup, { sticky: true });
        markerLayer.addLayer(mk);
    });

    // 5) 특정 줌 레벨 이상일 때만 Marker 보이도록 설정
    var SHOW_ZOOM_LEVEL = 6;
    function updateMarkers() {
        if (map.getZoom() >= SHOW_ZOOM_LEVEL) {
            if (!map.hasLayer(markerLayer)) {
                map.addLayer(markerLayer);
            }
        } else {
            if (map.hasLayer(markerLayer)) {
                map.removeLayer(markerLayer);
            }
        }
    }
    map.on('zoomend', updateMarkers);
    updateMarkers();
</script>
</html>

